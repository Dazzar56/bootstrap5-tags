var p="is-active",h=["is-active","bg-primary","text-white"],d="data-value",f=class{#a;#s;#i;#l;#t;#e;#r;constructor(t,e={}){t.style.display="none",t.dataset.tags=!0,this.#s=t;let s=i=>["true","false","1","0",!0,!1].includes(i)&&!!JSON.parse(i),l={...e,...t.dataset};for(this.allowNew=l.allowNew?s(l.allowNew):!1,this.showAllSuggestions=l.showAllSuggestions?s(l.showAllSuggestions):!1,this.badgeStyle=l.badgeStyle||"primary",this.allowClear=l.allowClear?s(l.allowClear):!1,this.server=l.server||!1,this.liveServer=l.liveServer?s(l.liveServer):!1,this.suggestionsThreshold=l.suggestionsThreshold?parseInt(l.suggestionsThreshold):1,this.validationRegex=l.regex||"",this.separator=l.separator?l.separator.split("|"):[],this.max=l.max?parseInt(l.max):null,this.clearLabel=l.clearLabel||"Clear",this.searchLabel=l.searchLabel||"Type a value",this.placeholder=this.#p(),this.#r=!1,this.parentForm=t.parentElement;this.parentForm&&(this.parentForm=this.parentForm.parentElement,this.parentForm.nodeName!="FORM"););if(this.parentForm.addEventListener("reset",i=>{this.reset()}),this.#i=document.createElement("div"),this.#l=document.createElement("div"),this.#t=document.createElement("ul"),this.#e=document.createElement("input"),this.#i.appendChild(this.#l),this.#l.appendChild(this.#e),this.#i.appendChild(this.#t),this.#s.parentNode.insertBefore(this.#i,this.#s.nextSibling),this.#b(),this.#m(),this.#v(),this.#g(),this.server&&!this.liveServer)this.#c();else{let i=Array.from(this.#s.querySelectorAll("option")).map(r=>({value:r.getAttribute("value"),label:r.innerText}));this.#u(i)}}static init(t="select[multiple]",e={}){let s=document.querySelectorAll(t);for(let l=0;l<s.length;l++)s[l].dataset.tags||new f(s[l],e)}#c(t=!1){this.#a&&this.#a.abort(),this.#a=new AbortController,fetch(this.server+"?query="+encodeURIComponent(this.#e.value),{signal:this.#a.signal}).then(e=>e.json()).then(e=>{let s=e.data||e;this.#u(s),this.#a=null,t&&this.#h()}).catch(e=>{e.name!=="AbortError"&&console.error(e)})}#p(){let t=this.#s.querySelector("option");if(!!t){if(!t.value){let e=t.innerText;return t.remove(),e}return this.#s.getAttribute("placeholder")?this.#s.getAttribute("placeholder"):this.#s.getAttribute("data-placeholder")?this.#s.getAttribute("data-placeholder"):""}}#v(){this.#t.classList.add("dropdown-menu","p-0"),this.#t.style.maxHeight="280px",this.#t.style.overflowY="auto",this.#t.addEventListener("mouseenter",t=>{this.#r=!1})}#m(){this.#i.classList.add("form-control","dropdown"),this.isDisabled()&&this.#i.setAttribute("readonly",""),this.#f()===4&&(this.#i.style.height="auto")}#g(){this.#l.addEventListener("click",e=>{this.isDisabled()||this.#e.focus()});let t=this.#s.querySelectorAll("option[selected]");for(let e=0;e<t.length;e++){let s=t[e];!s.value||(s.dataset.init=1,this.addItem(s.innerText,s.value))}}#b(){this.#e.type="text",this.#e.autocomplete="off",this.#e.style.backgroundColor="transparent",this.#e.style.border=0,this.#e.style.outline=0,this.#e.style.maxWidth="100%",this.#e.ariaLabel=this.searchLabel,this.isDisabled()&&this.#e.setAttribute("disabled",""),this.#n(),this.#e.addEventListener("input",t=>{this.#n(),this.#e.value.length>=this.suggestionsThreshold?this.liveServer?this.#c(!0):this.#h():this.#o()}),this.#e.addEventListener("focus",t=>{this.#e.value.length>=this.suggestionsThreshold&&this.#h()}),this.#e.addEventListener("focusout",t=>{this.#o()}),this.#e.addEventListener("keydown",t=>{let e=t.keyCode||t.key;if(this.separator.length&&this.separator.includes(t.key)){t.preventDefault(),this.addItem(this.#e.value,null)&&this.#d();return}switch(e){case 13:case"Enter":let s=this.getActiveSelection();s?s.click():this.allowNew&&!this.#L(this.#e.value)&&this.#e.value&&this.addItem(this.#e.value,null)&&this.#d(),t.preventDefault();break;case 38:case"ArrowUp":t.preventDefault(),this.#r=!0;let l=this.#y();this.#e.value.length==0&&this.#t.classList.contains("show")&&!l&&this.#o();break;case 40:case"ArrowDown":t.preventDefault(),this.#r=!0,this.#S(),this.#e.value.length==0&&!this.#t.classList.contains("show")&&this.#h();break;case 8:case"Backspace":this.#e.value.length==0&&(this.removeLastItem(),this.#n(),this.#o());break}})}#y(){let t=this.getActiveSelection();if(t){let e=t.parentNode;do e=e.previousSibling;while(e&&e.style.display=="none");return e?(t.classList.remove(...h),e.querySelector("a").classList.add(...h),e.parentNode.scrollTop=e.offsetTop-e.parentNode.offsetTop,e):null}return null}#S(){let t=this.getActiveSelection(),e=null;if(t){e=t.parentNode;do e=e.nextSibling;while(e&&e.style.display=="none");return e?(t.classList.remove(...h),e.querySelector("a").classList.add(...h),e.offsetTop>e.parentNode.offsetHeight-e.offsetHeight&&(e.parentNode.scrollTop+=e.offsetHeight),e):null}return e}#n(){this.#e.value?this.#e.size=this.#e.value.length+1:this.getSelectedValues().length?(this.#e.placeholder="",this.#e.size=1):(this.#e.size=this.placeholder.length,this.#e.placeholder=this.placeholder)}#u(t=null){for(;this.#t.lastChild;)this.#t.removeChild(this.#t.lastChild);for(let e=0;e<t.length;e++){let s=t[e];if(!s.value)continue;let l=document.createElement("li"),i=document.createElement("a");if(l.append(i),i.classList.add("dropdown-item"),i.setAttribute(d,s.value),i.setAttribute("href","#"),i.innerText=s.label,s.data)for(let[r,n]of Object.entries(s.data))i.dataset[r]=n;this.#t.appendChild(l),i.addEventListener("mouseenter",r=>{this.#r||(this.removeActiveSelection(),l.querySelector("a").classList.add(...h))}),i.addEventListener("mousemove",r=>{this.#r=!1}),i.addEventListener("mousedown",r=>{r.preventDefault()}),i.addEventListener("click",r=>{r.preventDefault(),this.addItem(i.innerText,i.getAttribute(d),i.dataset),this.#d()})}}reset(){this.removeAll();let t=this.#s.querySelectorAll("option[data-init]");for(let e=0;e<t.length;e++){let s=t[e];this.addItem(s.innerText,s.value)}this.#n()}#d(){this.#e.value="",this.#n(),this.#o(),this.max&&this.getSelectedValues().length===this.max?this.#e.style.visibility="hidden":this.#e.style.visibility=="hidden"&&(this.#e.style.visibility="visible")}getSelectedValues(){let t=this.#s.querySelectorAll("option:checked");return Array.from(t).map(e=>e.value)}#h(){this.#t.classList.contains("show")||this.#t.classList.add("show"),this.#t.style.left=this.#e.offsetLeft+"px";let t=this.#e.value.toLocaleLowerCase(),e=this.getSelectedValues(),s=this.#t.querySelectorAll("li"),l=!1,i=null,r=!1;for(let n=0;n<s.length;n++){let a=s[n],c=a.innerText.toLocaleLowerCase(),o=a.querySelector("a");if(o.classList.remove(...h),e.indexOf(o.getAttribute(d))!=-1){a.style.display="none";continue}r=!0;let u=t.length===0||c.indexOf(t)!==-1;this.showAllSuggestions||this.suggestionsThreshold===0||u?(a.style.display="list-item",l=!0,!i&&u&&(i=a)):a.style.display="none"}l||this.#t.classList.remove("show"),i?(this.#i.classList.contains("is-invalid")&&this.#i.classList.remove("is-invalid"),i.querySelector("a").classList.add(...h),i.parentNode.scrollTop=i.offsetTop-i.parentNode.offsetTop):!this.allowNew&&!(t.length===0&&!r)?this.#i.classList.add("is-invalid"):this.validationRegex&&this.#i.classList.contains("is-invalid")&&this.#i.classList.remove("is-invalid")}#o(){this.#t.classList.contains("show")&&this.#t.classList.remove("show"),this.#i.classList.contains("is-invalid")&&this.#i.classList.remove("is-invalid")}#f(){let t=5;return window.jQuery&&$.fn.tooltip!=null&&$.fn.tooltip.Constructor!=null&&(t=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),t}#L(t){let e=Array.from(this.#s.querySelectorAll("option")).find(s=>s.textContent==t);return!!(e&&e.getAttribute("selected"))}#w(t){return new RegExp(this.validationRegex.trim()).test(t)}getActiveSelection(){return this.#t.querySelector("a."+p)}removeActiveSelection(){let t=this.getActiveSelection();t&&t.classList.remove(...h)}removeAll(){this.#l.querySelectorAll("span").forEach(e=>{this.removeLastItem()})}removeLastItem(){let t=this.#l.querySelectorAll("span");if(!t.length)return;let e=t[t.length-1];this.removeItem(e.getAttribute(d))}isDisabled(){return this.#s.hasAttribute("disabled")||this.#s.hasAttribute("readonly")}addItem(t,e=null,s={}){if(e||(e=t),this.validationRegex&&!this.#w(t))return this.#i.classList.add("is-invalid"),!1;let l=this.#f(),i=this.#s.querySelector('option[value="'+e+'"]');i&&(s=i.dataset);let r=t,n=document.createElement("span"),a=["badge"],c=this.badgeStyle;if(s.badgeStyle&&(c=s.badgeStyle),s.badgeClass&&a.push(s.badgeClass),l===5?a=[...a,"me-2","bg-"+c]:a=[...a,"mr-2","badge-"+c],n.classList.add(...a),n.setAttribute(d,e),this.allowClear&&!this.isDisabled()&&(r=(l===5?'<button type="button" style="font-size:0.65em" class="me-2 btn-close btn-close-white" aria-label="'+this.clearLabel+'"></button>':'<button type="button" style="font-size:1em;float:left;text-shadow:none;color:currentColor;" class="mr-2 close" aria-label="'+this.clearLabel+'"><span aria-hidden="true">&times;</span></button>')+r),n.innerHTML=r,this.#l.insertBefore(n,this.#e),this.allowClear&&!this.isDisabled()&&n.querySelector("button").addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),this.removeItem(e),document.activeElement.blur()}),i)i.setAttribute("selected","selected");else{i=document.createElement("option"),i.value=e,i.innerText=t;for(let[o,u]of Object.entries(s))i.dataset[o]=u;i.setAttribute("selected","selected"),this.#s.appendChild(i)}return!0}removeItem(t){let e=this.#l.querySelector("span["+d+'="'+t+'"]');if(!e)return;e.remove();let s=this.#s.querySelector('option[value="'+t+'"]');s&&s.removeAttribute("selected"),this.#e.style.visibility=="hidden"&&this.max&&this.getSelectedValues().length<this.max&&(this.#e.style.visibility="visible")}},v=f;export{v as default};
//# sourceMappingURL=tags.min.js.map
