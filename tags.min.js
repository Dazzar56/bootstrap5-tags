var E={allowNew:!1,showAllSuggestions:!1,badgeStyle:"primary",allowClear:!1,clearEnd:!1,selected:[],regex:"",separator:[],max:0,clearLabel:"Clear",searchLabel:"Type a value",keepOpen:!1,allowSame:!1,baseClass:"",placeholder:"",addOnBlur:!1,showDisabled:!1,hideNativeValidation:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,highlightTyped:!1,fullWidth:!1,fixed:!1,activeClasses:["bg-primary","text-white"],labelField:"label",valueField:"value",queryParam:"query",server:"",serverMethod:"GET",serverParams:{},fetchOptions:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(d,t,e)=>t,onSelectItem:(d,t)=>{},onClearItem:(d,t)=>{},onCanAdd:(d,t,e)=>{},onServerResponse:d=>d.json()},g="tags-",x="is-loading",C="is-active",f="is-invalid",S="show",m="data-value",y="next",A="prev",I="form-control-focus",T="form-placeholder-shown",k="form-control-disabled",w=new WeakMap,O=0;function N(d,t=300){let e;return(...s)=>{clearTimeout(e),e=setTimeout(()=>{d.apply(this,s)},t)}}function q(d,t=null){let e=document.createElement("span");document.body.appendChild(e),e.style.fontSize=t||"inherit",e.style.height="auto",e.style.width="auto",e.style.position="absolute",e.style.whiteSpace="no-wrap",e.innerHTML=d;let s=Math.ceil(e.clientWidth);return document.body.removeChild(e),s}function F(d){return d.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function L(d){d.style.display="none",d.ariaHidden="true"}function D(d){d.style.display="list-item",d.ariaHidden="false"}var p=class{constructor(t,e={}){if(!(t instanceof HTMLElement)){console.error("Invalid element",t);return}w.set(t,this),O++,this.i=t,this.I(e),this.o=!1,this.T=N(()=>{this.v(!0)},this.e.debounceTime),this.d=!0,this.k(),this.n=document.createElement("div"),this.r=document.createElement("div"),this.n.appendChild(this.r),this.i.parentElement.insertBefore(this.n,this.i),this.O(),this.F(),this.D(),this.H(),this.M(),this.resetState(),this.e.fixed&&(document.addEventListener("scroll",this,!0),window.addEventListener("resize",this)),this.s.addEventListener("focus",this),this.s.addEventListener("blur",this),this.s.addEventListener("input",this),this.s.addEventListener("keydown",this),this.l.addEventListener("mousemove",this),this.loadData()}static init(t="select[multiple]",e={}){let s=document.querySelectorAll(t);for(let i=0;i<s.length;i++)p.getInstance(s[i])||new p(s[i],e)}static getInstance(t){if(w.has(t))return w.get(t)}dispose(){this.s.removeEventListener("focus",this),this.s.removeEventListener("blur",this),this.s.removeEventListener("input",this),this.s.removeEventListener("keydown",this),this.l.removeEventListener("mousemove",this),this.e.fixed&&(document.removeEventListener("scroll",this,!0),window.removeEventListener("resize",this)),this.i.style.display="block",this.n.parentElement.removeChild(this.n),this.parentForm&&this.parentForm.removeEventListener("reset",this),w.delete(this.i)}handleEvent(t){this[`on${t.type}`](t)}I(t={}){this.e=Object.assign({},E);let e={...t,...this.i.dataset},s=i=>["true","false","1","0",!0,!1].includes(i)&&!!JSON.parse(i);for(let[i,n]of Object.entries(E)){if(e[i]===void 0)continue;let l=e[i];switch(typeof n){case"number":this.e[i]=parseInt(l);break;case"boolean":this.e[i]=s(l);break;case"string":this.e[i]=l.toString();break;case"object":if(Array.isArray(n)){let a=l.includes("|")?"|":",";this.e[i]=typeof l=="string"?l.split(a):l}else this.e[i]=typeof l=="string"?JSON.parse(l):l;break;case"function":this.e[i]=typeof l=="string"?window[l]:l;break;default:this.e[i]=l;break}}this.e.placeholder||(this.e.placeholder=this.V())}k(){for(this.overflowParent=null,this.parentForm=this.i.parentElement;this.parentForm&&(this.parentForm.style.overflow==="hidden"&&(this.overflowParent=this.parentForm),this.parentForm=this.parentForm.parentElement,!(this.parentForm&&this.parentForm.nodeName=="FORM")););this.parentForm&&this.parentForm.addEventListener("reset",this)}V(){if(this.i.hasAttribute("placeholder"))return this.i.getAttribute("placeholder");if(this.i.dataset.placeholder)return this.i.dataset.placeholder;let t=this.i.querySelector("option");return t?(t.hasAttribute("selected")&&t.removeAttribute("selected"),t.value?"":t.textContent):""}D(){this.e.hideNativeValidation?(this.i.style.position="absolute",this.i.style.left="-9999px"):this.i.style.cssText="height:1px;width:1px;opacity:0;padding:0;margin:0;border:0;float:left;flex-basis:100%;",this.i.tabIndex=-1,this.i.addEventListener("focus",t=>{this.onclick()}),this.i.addEventListener("invalid",t=>{this.n.classList.add(f)})}M(){this.l=document.createElement("ul"),this.l.classList.add("dropdown-menu",g+"menu","p-0"),this.l.setAttribute("id",g+"menu-"+O),this.l.setAttribute("role","menu"),this.l.style.maxHeight="280px",this.e.fullWidth||(this.l.style.maxWidth="360px"),this.e.fixed&&(this.l.style.position="fixed"),this.l.style.overflowY="auto",this.l.style.overscrollBehavior="contain",this.l.style.textAlign="unset",this.l.addEventListener("mouseenter",t=>{this.o=!1}),this.n.appendChild(this.l),this.s.setAttribute("aria-controls",this.l.getAttribute("id"))}O(){this.n.classList.add("form-control","dropdown"),this.i.classList.contains("form-select-lg")&&this.n.classList.add("form-control-lg"),this.i.classList.contains("form-select-sm")&&this.n.classList.add("form-control-sm"),this.overflowParent&&(this.n.style.position="inherit"),this.g()===4&&(this.n.style.height="auto")}F(){this.r.addEventListener("click",e=>{this.isDisabled()||this.s.style.visibility!="hidden"&&this.s.focus()}),this.r.style.display="flex",this.r.style.alignItems="center",this.r.style.flexWrap="wrap";let t=this.i.selectedOptions||[];for(let e=0;e<t.length;e++){let s=t[e];!s.value||(s.setAttribute("selected","selected"),s.dataset.init="true",s.hasAttribute("disabled")&&(s.dataset.disabled="true"),this.S(s.textContent,s.value,s.dataset))}}H(){this.s=document.createElement("input"),this.s.type="text",this.s.autocomplete="off",this.s.spellcheck=!1,this.s.ariaAutoComplete="list",this.s.ariaExpanded="false",this.s.ariaHasPopup="menu",this.s.setAttribute("role","combobox"),this.s.ariaLabel=this.e.searchLabel,this.s.style.cssText="backgroundColor:transparent;color:currentColor;border:0;padding:0;outline:0;max-width:100%",this.resetSearchInput(!0),this.r.appendChild(this.s)}onfocus(t){this.n.classList.add(I),this.showOrSearch()}onblur(t){this.h&&this.h.abort();let e=!0;if(this.e.addOnBlur&&this.s.value&&(e=this.w()),this.n.classList.remove(I),this.hideSuggestions(e),this.d){let s=this.getSelection(),i={selection:s?s.dataset.value:null,input:this.s.value};this.i.dispatchEvent(new CustomEvent("tags.blur",{bubbles:!0,detail:i}))}}oninput(t){let e=this.s.value;if(e){let s=e.slice(-1);if(this.e.separator.length&&this.e.separator.includes(s)){this.s.value=this.s.value.slice(0,-1);let i=this.s.value,n=i;if(!this.e.allowNew){let l=this.getSelection();if(!l)return;i=l.getAttribute(m),n=l.dataset.label}this.u(n,i);return}}setTimeout(()=>{this.a()}),this.showOrSearch()}onkeydown(t){let e=t.keyCode||t.key,s=t.target;switch(t.keyCode==229&&(e=s.value.charAt(s.selectionStart-1).charCodeAt(0)),e){case 13:case"Enter":t.preventDefault(),this.w();break;case 38:case"ArrowUp":t.preventDefault(),this.o=!0,this.f(A);break;case 40:case"ArrowDown":t.preventDefault(),this.o=!0,this.isDropdownVisible()?this.f(y):this.showOrSearch(!1);break;case 8:case"Backspace":this.s.value.length==0&&(this.removeLastItem(),this.a(),this.showOrSearch());break;case 27:case"Escape":this.s.focus(),this.hideSuggestions();break}}onmousemove(t){this.o=!1}onscroll(t){this.m()}onresize(t){this.m()}onclick(t){this.s.focus()}onreset(t){this.reset()}loadData(){this.e.server?this.e.liveServer||this.v():this.resetSuggestions()}resetState(){this.isDisabled()?(this.n.setAttribute("readonly",""),this.s.setAttribute("disabled",""),this.n.classList.add(k)):(this.n.hasAttribute("readonly")&&this.n.removeAttribute("readonly"),this.s.hasAttribute("disabled")&&this.s.removeAttribute("disabled"),this.n.classList.remove(k))}resetSuggestions(){let t=Array.from(this.i.children).filter(e=>e instanceof HTMLOptGroupElement||!e.disabled||this.e.showDisabled).map(e=>e instanceof HTMLOptGroupElement?{group:e.getAttribute("label"),items:e.children}:{value:e.getAttribute("value"),label:e.textContent,disabled:e.disabled,data:Object.assign({},e.dataset)});this.L(t)}w(){let t=this.getSelection();if(t)return t.click(),!0;if(this.e.allowNew&&this.s.value){let e=this.s.value;return!!this.u(e,e,{new:1})}return!1}v(t=!1){this.h&&this.h.abort(),this.h=new AbortController;let e=Object.assign({},this.e.serverParams);if(e[this.e.queryParam]=this.s.value,this.e.noCache&&(e.t=Date.now()),e.related){let l=document.getElementById(e.related);l&&(e.related=l.value)}let s=new URLSearchParams(e),i=this.e.server,n=Object.assign(this.e.fetchOptions,{method:this.e.serverMethod||"GET",signal:this.h.signal});n.method==="POST"?n.body=s:i+="?"+s.toString(),this.n.classList.add(x),fetch(i,n).then(l=>this.e.onServerResponse(l)).then(l=>{let a=l.data||l;this.L(a),this.h=null,t&&this.p()}).catch(l=>{l.name!=="AbortError"&&console.error(l)}).finally(l=>{this.n.classList.remove(x)})}u(t,e=null,s={}){if(!this.canAdd(t,s))return null;let i=this.addItem(t,e,s);return this.e.keepOpen?this.p():this.resetSearchInput(),i}b(t){if(t.style.display==="none")return!1;let e=t.firstElementChild;return e.tagName==="A"&&!e.classList.contains("disabled")}f(t=y,e=null){let s=this.getSelection();if(s){let i=t===y?"nextSibling":"previousSibling";e=s.parentNode;do e=e[i];while(e&&!this.b(e));e?s.classList.remove(...this.c()):s&&(e=s.parentElement)}else{if(t===A)return e;if(!e)for(e=this.l.firstChild;e&&!this.b(e);)e=e.nextSibling}if(e){let i=e.offsetHeight,n=e.offsetTop,l=e.parentNode,a=l.offsetHeight,r=l.scrollHeight,h=l.offsetTop;if(i===0&&setTimeout(()=>{l.scrollTop=0}),t===A){let u=n-h>10?n-h:0;l.scrollTop=u}else n+i-(a+l.scrollTop)>0&&i>0&&(l.scrollTop=n+i-a+1,l.scrollTop+a>=r-10&&(l.scrollTop=n-h));let o=e.querySelector("a");o.classList.add(...this.c()),this.s.setAttribute("aria-activedescendant",o.getAttribute("id")),this.e.updateOnSelect&&(this.s.value=o.dataset.label,this.a())}else this.s.setAttribute("aria-activedescendant","");return e}a(){this.n.classList.remove(T),this.s.value?this.s.size=this.s.value.length:this.getSelectedValues().length?(this.s.placeholder="",this.s.size=1):(this.s.size=this.e.placeholder.length>0?this.e.placeholder.length:1,this.s.placeholder=this.e.placeholder,this.n.classList.add(T));let t=this.s.value||this.s.placeholder,e=window.getComputedStyle(this.n).fontSize,s=q(t,e)+16;this.s.style.width=s+"px"}L(t){for(;this.l.lastChild;)this.l.removeChild(this.l.lastChild);let e=0,s=1;for(let i=0;i<t.length;i++){let n=t[i];if(n.group){let l=document.createElement("li");l.setAttribute("role","presentation"),l.dataset.id=""+s;let a=document.createElement("span");if(l.append(a),a.classList.add("dropdown-header","text-truncate"),a.innerHTML=n.group,this.l.appendChild(l),n.items)for(let r=0;r<n.items.length;r++){let h=n.items[r];h.A=s,this.E(n.items[r],e),e++}s++}this.E(n,e),e++}if(this.e.notFoundMessage){let i=document.createElement("li");i.setAttribute("role","presentation"),i.classList.add(g+"not-found"),i.innerHTML=`<span class="dropdown-item">${this.e.notFoundMessage}</span>`,this.l.appendChild(i)}}E(t,e){if(!t[this.e.valueField])return;let s=t[this.e.valueField],i=t[this.e.labelField];if(this.e.server&&!this.e.liveServer&&(t.selected||this.e.selected.includes(s))){let r=this.u(i,s,t.data);r&&(r.dataset.init="true")}let n=this.e.onRenderItem(t,i,this),l=document.createElement("li");l.setAttribute("role","presentation"),t.A&&l.setAttribute("data-group-id",""+t.A);let a=document.createElement("a");l.append(a),a.setAttribute("id",this.l.getAttribute("id")+"-"+e),a.classList.add("dropdown-item","text-truncate"),t.disabled&&a.classList.add("disabled"),a.setAttribute(m,s),a.setAttribute("data-label",i),a.setAttribute("href","#"),a.innerHTML=n,this.l.appendChild(l),a.addEventListener("mouseenter",r=>{this.o||(this.removeSelection(),l.querySelector("a").classList.add(...this.c()))}),a.addEventListener("mousedown",r=>{r.preventDefault()}),a.addEventListener("click",r=>{r.preventDefault(),this.u(i,s,t.data),this.e.onSelectItem(t,this)})}initialOptions(){return this.i.querySelectorAll("option[data-init]")}reset(){this.removeAll(),this.d=!1;let t=this.initialOptions();for(let e=0;e<t.length;e++){let s=t[e];this.addItem(s.textContent,s.value,s.dataset)}this.a(),this.d=!0}resetSearchInput(t=!1){this.s.value="",this.a(),t||(this.hideSuggestions(),this.s===document.activeElement&&this.s.dispatchEvent(new Event("input"))),this.e.max&&this.getSelectedValues().length>=this.e.max?this.s.style.visibility="hidden":this.s.style.visibility=="hidden"&&(this.s.style.visibility="visible"),this.isSingle()&&!t&&document.activeElement.blur()}getSelectedValues(){let t=this.i.querySelectorAll("option[selected]");return Array.from(t).map(e=>e.value)}getAvailableValues(){let t=this.i.querySelectorAll("option");return Array.from(t).map(e=>e.value)}showOrSearch(t=!0){if(t&&!this.N()){this.hideSuggestions(!1);return}this.e.liveServer?this.T():this.p()}hideSuggestions(t=!0){this.l.classList.remove(S),this.s.ariaExpanded="false",this.removeSelection(),t&&this.n.classList.remove(f)}toggleSuggestions(t=!0,e=!0){this.l.classList.contains(S)?this.hideSuggestions(e):this.showOrSearch(t)}N(){return this.isDisabled()||this.e.maximumItems>0&&this.getSelectedValues().length>=this.e.maximumItems?!1:this.s.value.length>=this.e.suggestionsThreshold}p(){if(this.s.style.visibility=="hidden")return;let t=F(this.s.value).toLowerCase(),e=this.getSelectedValues(),s=this.l.querySelectorAll("li"),i=0,n=null,l=!1,a={};for(let r=0;r<s.length;r++){let h=s[r],o=h.firstElementChild;if(o instanceof HTMLSpanElement){h.dataset.id&&(a[h.dataset.id]=!1),L(h);continue}if(o.classList.remove(...this.c()),!this.e.allowSame&&e.indexOf(o.getAttribute(m))!=-1){L(h);continue}let u=F(o.textContent).toLowerCase(),c=t.length>0?u.indexOf(t):-1,b=c>=0||t.length===0&&this.e.suggestionsThreshold===0,H=this.e.showAllSuggestions||t.length===0,M=b||t.length===0;if(H||b?(i++,D(h),h.dataset.groupId&&(a[h.dataset.groupId]=!0),!n&&M&&(n=h),this.e.maximumItems>0&&i>this.e.maximumItems&&L(h)):L(h),this.e.highlightTyped&&b){let v=o.textContent,V=v.substring(0,c)+`<mark>${v.substring(c,c+t.length)}</mark>`+v.substring(c+t.length,v.length);o.innerHTML=V}this.b(h)&&(l=!0)}if(!this.e.allowNew&&!(t.length===0&&!l)&&this.n.classList.add(f),this.e.allowNew&&this.e.regex&&this.isInvalid()&&this.n.classList.remove(f),Array.from(s).filter(r=>r.dataset.id).forEach(r=>{a[r.dataset.id]===!0&&D(r)}),l&&(this.n.classList.remove(f),n&&this.e.autoselectFirst&&(this.removeSelection(),this.f(y,n))),i===0)if(this.e.notFoundMessage){let r=this.l.querySelector("."+g+"not-found");r.style.display="block",this.C()}else this.hideSuggestions(!1);else this.C()}C(){this.l.classList.add(S),this.s.ariaExpanded="true",this.m()}m(){let t=window.getComputedStyle(this.s),e=this.s.getBoundingClientRect(),s=t.direction==="rtl",i=null,n=null;if(this.e.fixed?(this.e.fullWidth?i=this.n.getBoundingClientRect().x:i=e.x,n=e.y+e.height):this.e.fullWidth?i=0:i=this.s.offsetLeft,s&&!this.e.fullWidth&&(i-=this.l.offsetWidth-e.width),!this.e.fullWidth){let h=Math.min(window.innerWidth,document.body.offsetWidth),o=s?e.x+e.width-this.l.offsetWidth-1:h-1-(e.x+this.l.offsetWidth);o<0&&(i=s?i-o:i+o)}this.l.style.transform="unset",this.e.fullWidth&&(this.l.style.width=this.n.offsetWidth+"px"),i!==null&&(this.l.style.left=i+"px"),n!==null&&(this.l.style.top=n+"px");let l=this.l.getBoundingClientRect(),a=Math.min(window.innerHeight,document.body.offsetHeight);a-1-(l.y+l.height)<0&&e.y>a/2&&(this.l.style.transform="translateY(calc(-100% - "+this.s.offsetHeight+"px))")}g(){let t=5;return window.jQuery&&$.fn.tooltip!=null&&$.fn.tooltip.Constructor!=null&&(t=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),t}q(t){let e=Array.from(this.i.querySelectorAll("option")).find(s=>s.textContent==t);return!!(e&&e.getAttribute("selected"))}W(t){return new RegExp(this.e.regex.trim()).test(t)}getSelection(){return this.l.querySelector("a."+C)}removeSelection(){let t=this.getSelection();t&&t.classList.remove(...this.c())}c(){return[...this.e.activeClasses,C]}getActiveSelection(){return this.getSelection()}removeActiveSelection(){return this.removeSelection()}removeAll(){this.getSelectedValues().forEach(e=>{this.removeItem(e,!0)}),this.a()}removeLastItem(t=!1){let e=this.r.querySelectorAll("span:not(.disabled)");if(!e.length)return;let s=e[e.length-1];this.removeItem(s.getAttribute(m),t)}enable(){this.i.setAttribute("disabled",""),this.resetState()}disable(){this.i.removeAttribute("disabled"),this.resetState()}isDisabled(){return this.i.hasAttribute("disabled")||this.i.disabled||this.i.hasAttribute("readonly")}isDropdownVisible(){return this.l.classList.contains(S)}isInvalid(){return this.n.classList.contains(f)}isSingle(){return!this.i.hasAttribute("multiple")}canAdd(t,e={}){return!t||this.isDisabled()||!this.isSingle()&&!this.e.allowSame&&this.q(t)||this.e.max&&this.getSelectedValues().length>=this.e.max?!1:this.e.regex&&e.new&&!this.W(t)?(this.n.classList.add(f),!1):this.e.onCanAdd&&this.e.onCanAdd(t,e,this)===!1?(this.n.classList.add(f),!1):!0}addItem(t,e=null,s={}){e||(e=t),this.isSingle()&&this.getSelectedValues().length&&this.removeLastItem(!0);let i=CSS.escape(e),n=this.i.querySelectorAll('option[value="'+i+'"]'),l=null;if(this.e.allowSame?n.forEach(r=>{r.textContent===t&&!r.selected&&(l=r)}):l=n[0]||null,!l){l=document.createElement("option"),l.value=e,l.textContent=t;for(let[r,h]of Object.entries(s))l.dataset[r]=h;this.i.appendChild(l)}l&&(s=Object.assign({},s,l.dataset)),l.setAttribute("selected","selected"),l.selected=!0;let a=this.i.innerHTML;return this.i.innerHTML="",this.i.innerHTML=a,this.S(t,e,s),this.d&&this.i.dispatchEvent(new Event("change",{bubbles:!0})),l}S(t,e=null,s={}){let i=this.g(),n=this.e.allowClear&&!s.disabled,l=t,a=document.createElement("span"),r=["badge"],h=this.e.badgeStyle;if(s.badgeStyle&&(h=s.badgeStyle),s.badgeClass&&r.push(...s.badgeClass.split(" ")),this.e.baseClass?r.push(...this.e.baseClass.split(" ")):i===5?r=[...r,"bg-"+h,"mw-100","overflow-x-hidden"]:r=[...r,"badge-"+h],s.disabled&&r.push("disabled","opacity-50"),a.style.margin="2px 6px 2px 0px",a.style.marginBlock="2px",a.style.marginInline="0px 6px",a.classList.add(...r),a.setAttribute(m,e),n){let o=r.includes("text-dark")?"btn-close":"btn-close-white",u,c;this.e.clearEnd?(u=i===5?"ms-2":"ml-2",c=i===5?"float-end":"float:right;"):(u=i===5?"me-2":"mr-2",c=i===5?"float-start":"float:left;"),l=(i===5?'<button type="button" style="font-size:0.65em" class="'+u+" "+c+" btn-close "+o+'" aria-label="'+this.e.clearLabel+'"></button>':'<button type="button" style="font-size:1em;'+c+'text-shadow:none;color:currentColor;transform:scale(1.2)" class="'+u+' close" aria-label="'+this.e.clearLabel+'"><span aria-hidden="true">&times;</span></button>')+l}a.innerHTML=l,this.r.insertBefore(a,this.s),n&&a.querySelector("button").addEventListener("click",o=>{o.preventDefault(),o.stopPropagation(),this.isDisabled()||(this.removeItem(e),document.activeElement.blur(),this.a())})}removeItem(t,e=!1){let s=CSS.escape(t),i=this.r.querySelector("span["+m+'="'+s+'"]');if(!i)return;i.remove();let n=this.i.querySelector('option[value="'+s+'"][selected]');n&&(n.removeAttribute("selected"),n.selected=!1,this.d&&!e&&this.i.dispatchEvent(new Event("change",{bubbles:!0}))),this.s.style.visibility=="hidden"&&this.e.max&&this.getSelectedValues().length<this.e.max&&(this.s.style.visibility="visible"),e||this.e.onClearItem(t,this)}},W=p;export{W as default};
//# sourceMappingURL=tags.min.js.map
