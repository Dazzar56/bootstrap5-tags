var y={allowNew:!1,showAllSuggestions:!1,badgeStyle:"primary",allowClear:!1,clearEnd:!1,selected:[],regex:"",separator:[],max:0,clearLabel:"Clear",searchLabel:"Type a value",keepOpen:!1,baseClass:"",placeholder:"",addOnBlur:!1,suggestionsThreshold:1,maximumItems:0,autoselectFirst:!0,updateOnSelect:!1,fullWidth:!1,labelField:"label",valueField:"value",items:[],source:null,datalist:"",server:"",serverParams:{},liveServer:!1,noCache:!0,debounceTime:300,notFoundMessage:"",onRenderItem:(o,t)=>t,onSelectItem:o=>{},onServerResponse:o=>o.json()},S="is-loading",C="is-active",f=["is-active","bg-primary","text-white"],m="data-value",b="next",A="prev",w="form-control-focus",g=new WeakMap,L=0;function x(o,t=300){let s;return(...i)=>{clearTimeout(s),s=setTimeout(()=>{o.apply(this,i)},t)}}function I(o,t=null){let s=document.createElement("span");document.body.appendChild(s),s.style.fontSize=t||"inherit",s.style.height="auto",s.style.width="auto",s.style.position="absolute",s.style.whiteSpace="no-wrap",s.innerHTML=o;let i=Math.ceil(s.clientWidth)+8;return document.body.removeChild(s),i}function E(o){return o.normalize("NFD").replace(/[\u0300-\u036f]/g,"")}function k(o,t){return o.parentNode.insertBefore(t,o.nextSibling)}var p=class{constructor(t,s={}){g.set(t,this),L++,this.l=t,this.A(s),this.h=!1,this.w=x(()=>{this.b(!0)},this.s.debounceTime),this.o=!0,this.c=[],this.L(),this.n=document.createElement("div"),this.a=document.createElement("div"),this.n.appendChild(this.a),k(this.l,this.n),this.E(),this.C(),this.x(),this.I(),this.k(),this.resetState(),this.e.addEventListener("focus",this),this.e.addEventListener("blur",this),this.e.addEventListener("input",this),this.e.addEventListener("keydown",this),this.i.addEventListener("mousemove",this),this.F()}static init(t="select[multiple]",s={}){let i=document.querySelectorAll(t);for(let l=0;l<i.length;l++)p.getInstance(i[l])||new p(i[l],s)}static getInstance(t){if(g.has(t))return g.get(t)}dispose(){this.e.removeEventListener("focus",this),this.e.removeEventListener("blur",this),this.e.removeEventListener("input",this),this.e.removeEventListener("keydown",this),this.i.removeEventListener("mousemove",this),this.l.style.display="block",this.n.parentElement.removeChild(this.n),this.parentForm&&this.parentForm.removeEventListener("reset",this.reset),g.delete(this.l)}handleEvent(t){this[`on${t.type}`](t)}A(t={}){this.s=Object.assign({},y);let s={...t,...this.l.dataset},i=l=>["true","false","1","0",!0,!1].includes(l)&&!!JSON.parse(l);for(let[l,r]of Object.entries(y)){if(s[l]===void 0)continue;let a=s[l];switch(typeof r){case"number":this.s[l]=parseInt(a);break;case"boolean":this.s[l]=i(a);break;case"string":this.s[l]=a.toString();break;case"object":if(Array.isArray(r)){let h=a.includes("|")?"|":",";this.s[l]=typeof a=="string"?a.split(h):a}else this.s[l]=typeof a=="string"?JSON.parse(a):a;break;case"function":this.s[l]=typeof a=="string"?window[a]:a;break;default:this.s[l]=a;break}}this.s.placeholder||(this.s.placeholder=this.O())}L(){for(this.overflowParent=null,this.parentForm=this.l.parentElement;this.parentForm&&(this.parentForm.style.overflow==="hidden"&&(this.overflowParent=this.parentForm),this.parentForm=this.parentForm.parentElement,!(this.parentForm&&this.parentForm.nodeName=="FORM")););this.reset=this.reset.bind(this),this.parentForm&&this.parentForm.addEventListener("reset",this.reset)}O(){if(this.l.hasAttribute("placeholder"))return this.l.getAttribute("placeholder");if(this.l.dataset.placeholder)return this.l.dataset.placeholder;let t=this.l.querySelector("option");return t?(t.hasAttribute("selected")&&t.removeAttribute("selected"),t.value?"":t.textContent):""}E(){this.l.style.position="absolute",this.l.style.left="-9999px",this.l.addEventListener("focus",t=>{this.e.focus()})}k(){this.i=document.createElement("ul"),this.i.classList.add("dropdown-menu","tags-menu","p-0"),this.i.setAttribute("id","tags-menu-"+L),this.i.setAttribute("role","menu"),this.i.style.maxHeight="280px",this.s.fullWidth||(this.i.style.maxWidth="360px"),this.i.style.overflowY="auto",this.i.addEventListener("mouseenter",t=>{this.h=!1}),this.n.appendChild(this.i),this.e.setAttribute("aria-controls",this.i.getAttribute("id"))}C(){this.n.classList.add("form-control","dropdown"),this.l.classList.contains("form-select-lg")&&this.n.classList.add("form-control-lg"),this.l.classList.contains("form-select-sm")&&this.n.classList.add("form-control-sm"),this.overflowParent&&(this.n.style.position="inherit"),this.g()===4&&(this.n.style.height="auto")}x(){this.a.addEventListener("click",s=>{this.isDisabled()||this.e.style.visibility!="hidden"&&this.e.focus()});let t=this.l.selectedOptions??[];for(let s=0;s<t.length;s++){let i=t[s];!i.value||(this.c.push(i),this.addItem(i.textContent,i.value))}}I(){this.e=document.createElement("input"),this.e.type="text",this.e.autocomplete="off",this.e.spellcheck=!1,this.e.ariaAutoComplete="list",this.e.ariaExpanded="false",this.e.ariaHasPopup="menu",this.e.setAttribute("role","combobox"),this.e.ariaLabel=this.s.searchLabel,this.e.style.backgroundColor="transparent",this.e.style.border=0,this.e.style.outline=0,this.e.style.maxWidth="100%",this.resetSearchInput(!0),this.a.appendChild(this.e)}onfocus(t){this.n.classList.add(w),this.m()}onblur(t){let s=this.getSelection(),i={selection:s?s.dataset.value:null,input:this.e.value};this.n.classList.remove(w),this.d(),this.s.keepOpen&&this.resetSearchInput(),this.s.addOnBlur&&this.s.allowNew&&this.canAdd(i.input)&&(this.addItem(i.input),this.resetSearchInput()),this.o&&this.l.dispatchEvent(new CustomEvent("tags.blur",{bubbles:!0,detail:i}))}oninput(t){let s=this.e.value;if(s){let i=s.slice(-1);if(this.s.separator.length&&this.s.separator.includes(i)){this.e.value=this.e.value.slice(0,-1),this.u(this.e.value,null);return}}this.r(),this.m()}onkeydown(t){let s=t.keyCode||t.key;switch(t.keyCode==229&&(s=e.target.value.charAt(e.target.selectionStart-1).charCodeAt()),s){case 13:case"Enter":t.preventDefault();let i=this.getSelection();if(i)i.click();else if(this.s.allowNew&&this.e.value){let l=this.e.value;this.u(l,null)}break;case 38:case"ArrowUp":t.preventDefault(),this.h=!0,this.p(A);break;case 40:case"ArrowDown":t.preventDefault(),this.h=!0,this.p(b);break;case 8:case"Backspace":this.e.value.length==0&&(this.removeLastItem(),this.r(),this.m());break;case 27:case"Escape":this.e.focus(),this.d();break}}onmousemove(t){this.h=!1}resetState(){this.isDisabled()?(this.n.setAttribute("readonly",""),this.e.setAttribute("disabled","")):(this.n.hasAttribute("readonly")&&this.n.removeAttribute("readonly"),this.e.hasAttribute("disabled")&&this.e.removeAttribute("disabled"))}resetSuggestions(){let t=Array.from(this.l.querySelectorAll("option")).filter(s=>!s.disabled).map(s=>({value:s.getAttribute("value"),label:s.textContent}));this.S(t)}b(t=!1){this.f&&this.f.abort(),this.f=new AbortController;let s=Object.assign({},this.s.serverParams);if(s.query=this.e.value,this.s.noCache&&(s.t=Date.now()),s.related){let l=document.getElementById(s.related);l&&(s.related=l.value)}let i=new URLSearchParams(s).toString();this.n.classList.add(S),fetch(this.s.server+"?"+i,{signal:this.f.signal}).then(l=>this.s.onServerResponse(l)).then(l=>{let r=l.data||l;this.S(r),this.f=null,t&&this.v()}).catch(l=>{l.name!=="AbortError"&&console.error(l)}).finally(l=>{this.n.classList.remove(S)})}u(t,s=null,i={}){!this.canAdd(t,s)||(this.addItem(t,s,i),this.s.keepOpen?this.v():this.resetSearchInput())}p(t=b){let s=this.getSelection(),i=null;if(s){let l=t===b?"nextSibling":"previousSibling";i=s.parentNode;do i=i[l];while(i&&i.style.display==="none");i?(s.classList.remove(...f),t===A?i.parentNode.scrollTop=i.offsetTop-i.parentNode.offsetTop:i.offsetTop>i.parentNode.offsetHeight-i.offsetHeight&&(i.parentNode.scrollTop+=i.offsetHeight)):s&&(i=s.parentElement)}else for(i=this.i.firstChild;i&&i.style.display==="none";)i=i.nextSibling;if(i){let l=i.querySelector("a");l.classList.add(...f),this.e.setAttribute("aria-activedescendant",l.getAttribute("id")),this.s.updateOnSelect&&(this.e.value=l.dataset.label,this.r())}else this.e.setAttribute("aria-activedescendant","");return i}r(){this.e.value?this.e.size=this.e.value.length:this.getSelectedValues().length?(this.e.placeholder="",this.e.size=1):(this.e.size=this.s.placeholder.length>0?this.s.placeholder.length:1,this.e.placeholder=this.s.placeholder);let t=this.e.value||this.e.placeholder,s=window.getComputedStyle(this.n).fontSize,i=I(t,s);this.e.style.minWidth=i+"px"}S(t){for(;this.i.lastChild;)this.i.removeChild(this.i.lastChild);for(let s=0;s<t.length;s++){let i=t[s];if(!i[this.s.valueField])continue;let l=i[this.s.valueField],r=i[this.s.labelField];if(!this.s.liveServer&&(i.selected||this.s.selected.includes(l))){this.c.push({value:l,textContent:r,dataset:i.data}),this.u(r,l,i.data);continue}let a=this.s.onRenderItem(i,r),h=document.createElement("li");h.setAttribute("role","presentation");let n=document.createElement("a");h.append(n),n.setAttribute("id",this.i.getAttribute("id")+"-"+s),n.classList.add("dropdown-item","text-truncate"),n.setAttribute(m,l),n.setAttribute("data-label",r),n.setAttribute("href","#"),n.textContent=a,this.i.appendChild(h),n.addEventListener("mouseenter",d=>{this.h||(this.removeSelection(),h.querySelector("a").classList.add(...f))}),n.addEventListener("mousedown",d=>{d.preventDefault()}),n.addEventListener("click",d=>{d.preventDefault(),this.u(a,l,i.data),this.s.onSelectItem(i)})}if(this.s.notFoundMessage){let s=document.createElement("li");s.setAttribute("role","presentation"),s.classList.add("tags-not-found"),s.innerHTML=`<span class="dropdown-item">${this.s.notFoundMessage}</span>`,this.i.appendChild(s)}}reset(){this.removeAll(),this.o=!1;for(let t=0;t<this.c.length;t++){let s=this.c[t];this.addItem(s.textContent,s.value,s.dataset)}this.r(),this.o=!0}resetSearchInput(t=!1){this.e.value="",this.r(),t||(this.d(),this.e===document.activeElement&&this.e.dispatchEvent(new Event("input"))),this.s.max&&this.getSelectedValues().length>=this.s.max?this.e.style.visibility="hidden":this.e.style.visibility=="hidden"&&(this.e.style.visibility="visible"),this.isSingle()&&!t&&document.activeElement.blur()}getSelectedValues(){let t=this.l.querySelectorAll("option[selected]");return Array.from(t).map(s=>s.value)}T(){return this.isDisabled()?!1:this.e.value.length>=this.s.suggestionsThreshold}m(){if(!this.T()){this.d();return}this.s.liveServer?this.w():this.v()}v(){if(this.e.style.visibility=="hidden")return;let t=E(this.e.value).toLowerCase(),s=this.getSelectedValues(),i=this.i.querySelectorAll("li"),l=0,r=null,a=!1;for(let h=0;h<i.length;h++){let n=i[h],d=n.querySelector("a");if(!d){n.style.display="none";continue}if(d.classList.remove(...f),s.indexOf(d.getAttribute(m))!=-1){n.style.display="none";continue}a=!0;let u=E(n.textContent).toLowerCase(),c=t.length>0?u.indexOf(t)>=0:!0;this.s.showAllSuggestions||c?(l++,n.style.display="list-item",!r&&c&&(r=n),this.s.maximumItems>0&&l>this.s.maximumItems&&(n.style.display="none")):n.style.display="none"}r||this.s.showAllSuggestions?(this.n.classList.remove("is-invalid"),r&&this.s.autoselectFirst&&this.p(b)):!this.s.allowNew&&!(search.length===0&&!a)?this.n.classList.add("is-invalid"):this.s.regex&&this.isInvalid()&&this.n.classList.remove("is-invalid"),l===0||this.isInvalid()?this.s.notFoundMessage?this.i.querySelector(".tags-not-found").style.display="block":this.d():(this.i.classList.add("show"),this.e.ariaExpanded="true",this.N())}N(){if(this.s.fullWidth)this.i.style.left=-1+"px",this.i.style.width=this.n.offsetWidth+"px";else{let t=this.e.offsetLeft,s=document.body.offsetWidth-1,i=30,l=s-(t+this.i.offsetWidth)-i;l<0&&(t=t+l),this.i.style.left=t+"px";let r=document.body.offsetHeight,a=this.e.getBoundingClientRect().y+window.pageYOffset+this.i.offsetHeight;r-a<0?this.i.style.transform="translateY(calc(-100% - "+i+"px))":this.i.style.transform="none"}}d(){this.i.classList.remove("show"),this.n.classList.remove("is-invalid"),this.e.ariaExpanded="false",this.removeSelection()}g(){let t=5;return window.jQuery&&$.fn.tooltip!=null&&$.fn.tooltip.Constructor!=null&&(t=parseInt($.fn.tooltip.Constructor.VERSION.charAt(0))),t}D(t){let s=Array.from(this.l.querySelectorAll("option")).find(i=>i.textContent==t);return!!(s&&s.getAttribute("selected"))}F(){this.s.server&&!this.s.liveServer?this.b():this.resetSuggestions()}q(t){return new RegExp(this.s.regex.trim()).test(t)}getSelection(){return this.i.querySelector("a."+C)}removeSelection(){let t=this.getSelection();t&&t.classList.remove(...f)}getActiveSelection(){return this.getSelection()}removeActiveSelection(){return this.removeSelection()}removeAll(){this.getSelectedValues().forEach(s=>{this.removeItem(s,!0)}),this.r()}removeLastItem(t){let s=this.a.querySelectorAll("span");if(!s.length)return;let i=s[s.length-1];this.removeItem(i.getAttribute(m),t)}isDisabled(){return this.l.hasAttribute("disabled")||this.l.disabled||this.l.hasAttribute("readonly")}isInvalid(){return this.n.classList.contains("is-invalid")}isSingle(){return!this.l.hasAttribute("multiple")}canAdd(t,s=null){return s||(s=t),!t||this.isDisabled()||!this.isSingle()&&this.D(t)||this.s.max&&this.getSelectedValues().length>=this.s.max?!1:this.s.regex&&!this.q(t)?(this.n.classList.add("is-invalid"),!1):!0}addItem(t,s=null,i={}){s||(s=t),this.isSingle()&&this.getSelectedValues().length&&this.removeLastItem(!0);let l=this.g(),r=this.l.querySelector('option[value="'+s+'"]');r&&(i=r.dataset);let a=t,h=document.createElement("span"),n=["badge"],d=this.s.badgeStyle;if(i.badgeStyle&&(d=i.badgeStyle),i.badgeClass&&n.push(...i.badgeClass.split(" ")),this.s.baseClass?(l===5?n.push("me-2"):n.push("mr-2"),n.push(...this.s.baseClass.split(" "))):l===5?n=[...n,"me-2","bg-"+d,"mw-100"]:n=[...n,"mr-2","badge-"+d],h.classList.add(...n),h.setAttribute(m,s),this.s.allowClear){let u=n.includes("text-dark")?"btn-close":"btn-close-white",c,v;this.s.clearEnd?(c=l===5?"ms-2":"ml-2",v=l===5?"float-end":"float:right;"):(c=l===5?"me-2":"mr-2",v=l===5?"float-start":"float:left;"),a=(l===5?'<button type="button" style="font-size:0.65em" class="'+c+" "+v+" btn-close "+u+'" aria-label="'+this.s.clearLabel+'"></button>':'<button type="button" style="font-size:1em;'+v+'text-shadow:none;color:currentColor;transform:scale(1.2)" class="'+c+' close" aria-label="'+this.s.clearLabel+'"><span aria-hidden="true">&times;</span></button>')+a}if(h.innerHTML=a,this.a.insertBefore(h,this.e),this.s.allowClear&&h.querySelector("button").addEventListener("click",u=>{u.preventDefault(),u.stopPropagation(),this.isDisabled()||(this.removeItem(s),document.activeElement.blur(),this.r())}),!r){r=document.createElement("option"),r.value=s,r.textContent=t;for(let[u,c]of Object.entries(i))r.dataset[u]=c;this.l.appendChild(r)}r.setAttribute("selected","selected"),r.selected=!0,this.o&&this.l.dispatchEvent(new Event("change",{bubbles:!0}))}removeItem(t,s=!1){let i=this.a.querySelector("span["+m+'="'+t+'"]');if(!i)return;i.remove();let l=this.l.querySelector('option[value="'+t+'"]');l&&(l.removeAttribute("selected"),l.selected=!1,this.o&&!s&&this.l.dispatchEvent(new Event("change",{bubbles:!0}))),this.e.style.visibility=="hidden"&&this.s.max&&this.getSelectedValues().length<this.s.max&&(this.e.style.visibility="visible")}},O=p;export{O as default};
//# sourceMappingURL=tags.min.js.map
